<html>
  <head>
    <meta charset = "UTF-8">
    <meta name = "Description" content = "Universal smooth scroll demo">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <title>Universal Smooth Scroll</title>
    <link rel = "icon" type = "image/png" href = "./docs/images/favicon.png">
    <link rel = "stylesheet" type = "text/css" href = "./index.css">
    <script async src = "./src/universalsmoothscroll.js"></script>
    <script async src = "./src/universalsmoothscroll-ease-functions.js"></script>
    <script async src = "./src/universalsmoothscroll-dev-helpers.js" type = "module"></script>
    <script async src = "./src/universalsmoothscroll-presets.js" type = "module"></script> <!--  type = "module" -->
  </head>
  <body>
    <div id = "betaBanner"><p>Beta 6.0.0</p></div>
    <nav id = "header">
      <ul>
        <li><a href = "#section1">YELLOW</a></li>
        <li><a href = "#section2">BLUE</a></li>
        <li><a href = "#section4">GREEN</a></li>
        <li><a href = "#section3">RED</a></li>
      </ul>
    </nav>
    <!--SECTION 1 AND 2 -->
    <div class = "sections-container">
      <div id = "section1" class = "page">
          <h2>Select the above anchor's easing</h2>
          <div id = "easeFunctionSelector">
            <div id = "easeFunctionSelectorList">
              <a id = "linear"        >linear</a>
              <a id = "easeInSine"    >easeInSine</a>
              <a id = "easeInQuad"    >easeInQuad</a>
              <a id = "easeInCubic"   >easeInCubic</a>
              <a id = "easeInQuart"   >easeInQuart</a>
              <a id = "easeInQuint"   >easeInQuint</a>
              <a id = "easeInExpo"    >easeInExpo</a>
              <a id = "easeInCirc"    >easeInCirc</a>
              <a id = "easeOutSine"   >easeOutSine</a>
              <a id = "easeOutQuad"   >easeOutQuad</a>
              <a id = "easeOutCubic"  >easeOutCubic</a>
              <a id = "easeOutQuart"  >easeOutQuart</a>
              <a id = "easeOutQuint"  >easeOutQuint</a>
              <a id = "easeOutExpo"   >easeOutExpo</a>
              <a id = "easeOutCirc"   >easeOutCirc</a>
              <a id = "easeInOutSine" >easeInOutSine</a>
              <a id = "easeInOutQuad" >easeInOutQuad</a>
              <a id = "easeInOutCubic">easeInOutCubic</a>
              <a id = "easeInOutQuart">easeInOutQuart</a>
              <a id = "easeInOutQuint">easeInOutQuint</a>
              <a id = "easeInOutExpo" >easeInOutExpo</a>
              <a id = "easeInOutCirc" >easeInOutCirc</a>

              <a id = "easeInBounce"  >easeInBounce</a>
              <a id = "easeOutBounce" >easeOutBounce</a>
              <a id = "easeInOutBounce" >easeInOutBounce</a>
            </div>
          </div>
      </div>
      <div id = "section2" class = "page">
        <section id = "yScroller">
          <!-- <button id = "yScrollerUp">&uarr;</button> -->
          <div id = "yScrollerSection" class = "scrollerSections">
            <div id = "section12" class = "listItem"></div>
            <div id = "section22" class = "listItem"></div>
            <div id = "section32" class = "listItem"></div>
            <div id = "section42" class = "listItem"></div>
          </div>
          <!-- <button id = "yScrollerDown">&darr;</button> -->
        </section>
      </div>
    </div>

    <!--SECTION 3 AND 4 -->
    <div class = "sections-container">
      <div id = "section3" class = "page">
        <section id = "xScroller">
          <!-- <button id = "xScrollerLeft">&larr;</button> -->
          <div id = "xScrollerSection" class = "scrollerSections">
            <div id = "section11" class = "listItem"></div>
            <div id = "section21" class = "listItem"></div>
            <div id = "section31" class = "listItem"></div>
            <div id = "section41" class = "listItem"></div>
          </div>
          <!-- <button id = "xScrollerRight">&rarr;</button> -->
        </section>
      </div>
      <div id = "section4" class = "page">
        <div id = "customBezierParameterSection">
          <h2 id = "bezierTitle">Choose custom cubic-bezier parameters</h2>
          <ul>
            <li><input type = "text" class = "cubicBezierParameter" value = "0"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "0"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "1"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "1"/></li>
          </ul>
          <input type = "submit" value = "Customize"></input>
        </div>
      </div>
    </div>
  </body>
</html>

<!--  type = "module" -->
<script type = "module"> 
  import {  
    isValidStepLengthCalculator,
  } from "./src/universalsmoothscroll-dev-helpers.js";

  import {
    addMomentumScrolling, 
    addMomentumSnapScrolling, 
    addElasticMomentumScrolling,
    addSmoothScrollbar
  } from "./src/universalsmoothscroll-presets.js"; 

  window.addEventListener("load", () => {
    const pageScroller = document.body;

    const yScrollerSection = document.getElementById("yScrollerSection");
    const yScrollerUpButton = document.getElementById("yScrollerUp");
    const yScrollerDownButton = document.getElementById("yScrollerDown");

    const xScrollerSection = document.getElementById("xScrollerSection");
    const xScrollerLeftButton = document.getElementById("xScrollerLeft");
    const xScrollerRightButton = document.getElementById("xScrollerRight");

    const cubicBezierCustomInputParameters = document.getElementsByTagName("input");
    const easeFunctionSelectorList = document.getElementById("easeFunctionSelectorList");
    
    let lastAnchorPressed = null;

    const listItems = easeFunctionSelectorList.children;
    listItems[0].classList.add("selected");
    for(const li of listItems) {
      li.addEventListener("click", () => {
        document.getElementsByClassName("selected")[0].classList.remove("selected");
        li.classList.add("selected");
      }, {passive:true});
    }

    function setEasingsBody(easingX, easingY) {
      _bodyMomentumScrollingOptions.momentumEasingX = easingX;
      _bodyMomentumScrollingOptions.momentumEasingY = easingY;
    }

    document.getElementById("linear").addEventListener("click",          () => setEasingsBody(EASE_LINEAR(), EASE_LINEAR()));

    document.getElementById("easeInSine").addEventListener("click",      () => setEasingsBody(EASE_IN_SINE(), EASE_IN_SINE()));
    document.getElementById("easeInQuad").addEventListener("click",      () => setEasingsBody(EASE_IN_QUAD(), EASE_IN_QUAD()));
    document.getElementById("easeInCubic").addEventListener("click",     () => setEasingsBody(EASE_IN_CUBIC(), EASE_IN_CUBIC()));
    document.getElementById("easeInQuart").addEventListener("click",     () => setEasingsBody(EASE_IN_QUART(), EASE_IN_QUART()));
    document.getElementById("easeInQuint").addEventListener("click",     () => setEasingsBody(EASE_IN_QUINT(), EASE_IN_QUINT()));
    document.getElementById("easeInExpo").addEventListener("click",      () => setEasingsBody(EASE_IN_EXPO(), EASE_IN_EXPO()));
    document.getElementById("easeInCirc").addEventListener("click",      () => setEasingsBody(EASE_IN_CIRC(), EASE_IN_CIRC() ));

    document.getElementById("easeOutSine").addEventListener("click",     () => setEasingsBody(EASE_OUT_SINE(), EASE_OUT_SINE()));
    document.getElementById("easeOutQuad").addEventListener("click",     () => setEasingsBody(EASE_OUT_QUAD(), EASE_OUT_QUAD()));
    document.getElementById("easeOutCubic").addEventListener("click",    () => setEasingsBody(EASE_OUT_CUBIC(), EASE_OUT_CUBIC()));
    document.getElementById("easeOutQuart").addEventListener("click",    () => setEasingsBody(EASE_OUT_QUART(), EASE_OUT_QUART()));
    document.getElementById("easeOutQuint").addEventListener("click",    () => setEasingsBody(EASE_OUT_QUINT(), EASE_OUT_QUINT()));
    document.getElementById("easeOutExpo").addEventListener("click",     () => setEasingsBody(EASE_OUT_EXPO(), EASE_OUT_EXPO()));
    document.getElementById("easeOutCirc").addEventListener("click",     () => setEasingsBody(EASE_OUT_CIRC(), EASE_OUT_CIRC()));

    document.getElementById("easeInOutSine").addEventListener("click",   () => setEasingsBody(EASE_IN_OUT_SINE(), EASE_IN_OUT_SINE()));
    document.getElementById("easeInOutQuad").addEventListener("click",   () => setEasingsBody(EASE_IN_OUT_QUAD(), EASE_IN_OUT_QUAD()));
    document.getElementById("easeInOutCubic").addEventListener("click",  () => setEasingsBody(EASE_IN_OUT_CUBIC(), EASE_IN_OUT_CUBIC()));
    document.getElementById("easeInOutQuart").addEventListener("click",  () => setEasingsBody(EASE_IN_OUT_QUART(), EASE_IN_OUT_QUART()));
    document.getElementById("easeInOutQuint").addEventListener("click",  () => setEasingsBody(EASE_IN_OUT_QUINT(), EASE_IN_OUT_QUINT()));
    document.getElementById("easeInOutExpo").addEventListener("click",   () => setEasingsBody(EASE_IN_OUT_EXPO(), EASE_IN_OUT_EXPO()));
    document.getElementById("easeInOutCirc").addEventListener("click",   () => setEasingsBody(EASE_IN_OUT_CIRC(), EASE_IN_OUT_CIRC()));

    document.getElementById("easeInBounce").addEventListener("click",    () => setEasingsBody(EASE_IN_BOUNCE(), EASE_IN_BOUNCE()));
    document.getElementById("easeOutBounce").addEventListener("click",   () => setEasingsBody(EASE_OUT_BOUNCE(), EASE_OUT_BOUNCE()));
    document.getElementById("easeInOutBounce").addEventListener("click", () => setEasingsBody(EASE_IN_OUT_BOUNCE(), EASE_IN_OUT_BOUNCE()));
    
    let bezierTitleTimeout = 0;
    cubicBezierCustomInputParameters[4].addEventListener("click", () => {
      window.clearTimeout(bezierTitleTimeout);

      for(let i = 0; i < 4; i++) {
        const ux = Number.parseFloat(cubicBezierCustomInputParameters[i].value);

        if(!Number.isFinite(ux) || ux < 0 || ux > 1) {
          document.getElementById("bezierTitle").innerHTML = "Parameters must be numbers from 0 to 1";
          bezierTitleTimeout = window.setTimeout(() => title.innerHTML = "Choose custom cubic-bezier parameters", 5000);
          return;
        }
      }
      
      const u0 = Number.parseFloat(cubicBezierCustomInputParameters[0].value);
      const u1 = Number.parseFloat(cubicBezierCustomInputParameters[1].value);
      const u2 = Number.parseFloat(cubicBezierCustomInputParameters[2].value);
      const u3 = Number.parseFloat(cubicBezierCustomInputParameters[3].value);

      uss.setStepLengthCalculator(CUSTOM_CUBIC_BEZIER(u0, u1, u2, u3));
      title.innerHTML = "All set, try it out !";
      bezierTitleTimeout = window.setTimeout(() => title.innerHTML = "Choose custom cubic-bezier parameters", 5000);
    }, {passive:true});
    
    

    const _bodyMomentumScrollingOptions = {
      onYAxis: true,
      onXAxis: true,
      momentumEasingX: EASE_LINEAR(), //TODO fix the lag of these
      momentumEasingY: EASE_LINEAR(),
    }
    addMomentumScrolling(
      pageScroller,
      _bodyMomentumScrollingOptions
    );

    const _elasticOptions = {
      onYAxis: true, 
      elasticAmount: 0.25 * window.innerHeight, //25vh in css
      children: [
        {
          element: easeFunctionSelectorList.children[0]
        }, 
        {
          element: easeFunctionSelectorList.children[easeFunctionSelectorList.children.length - 1]
        },
      ]
    }
    addElasticMomentumScrolling(
      easeFunctionSelectorList,
      _elasticOptions
    );
    uss.addOnResizeEndCallback(() => _elasticOptions.elasticAmount = 0.25 * window.innerHeight);

    const __yChildren = Array.from(yScrollerSection.children);
    const _yChildren = [
      {
        element:__yChildren[0],
        align: "start"
      },
      {
        element:__yChildren[1],
        align: "end"
      },
      {
        element:__yChildren[2],
        align: "center"
      },
      {
        element:__yChildren[3],
        align: "end"
      }
    ];
    addMomentumSnapScrolling(
      yScrollerSection, 
      {
        onYAxis: "mandatory", 
        children: _yChildren
      }
    );
    
    const __xChildren = Array.from(xScrollerSection.children);
    const _xChildren = [
      {
        element:__xChildren[0],
        align: "start"
      },
      {
        element:__xChildren[1],
        align: "end"
      },
      {
        element:__xChildren[2],
        align: "center"
      },
      {
        element:__xChildren[3],
        align: "end"
      }
  ];

  /*
  const _children = Array.from(xScrollerSection.children)
                         .map(
                          (el) => {
                            return {
                              element: el,
                              align: "center"
                            }
                          }
                         )
    */
    addMomentumSnapScrolling(
      xScrollerSection, 
      {
        onXAxis: "mandatory", 
        children: _xChildren,
        //speedModifierX: (deltaX, deltaY) => deltaX > 0 ? deltaX : deltaY
      }
    );


    const _bodyScrollbars = addSmoothScrollbar(
        document.body, 
        {
            onYAxis:true,
            onXAxis:true,
            transitionDurationX: "0.6s",
            transitionDurationY: "0.6s",
            hideScrollbarX: true,
            hideScrollbarY: true
        }
    )

    const _xScrollerScrollbars = addSmoothScrollbar(
        xScrollerSection, 
        {
            onXAxis:true,
            transitionDurationX: "0.4s",
            hideScrollbarX: true
        }
    )
    
    const _yScrollerScrollbars = addSmoothScrollbar(
        yScrollerSection, 
        {
            onYAxis:true,
            transitionDurationY: "0.4s",
            hideScrollbarY: true
        }
    )

    const _easeFunctionSelectorListScrollbars = addSmoothScrollbar(
        easeFunctionSelectorList, 
        {
            onYAxis:true,
            transitionDurationY: "0.4s",
            hideScrollbarY: true
        }
    )

    uss.hrefSetup(null, true, (anchor, el) => {
      if(anchor && lastAnchorPressed === anchor && uss.isScrolling()) return false;
      lastAnchorPressed = anchor;

      //Unsets the temporary StepLengthCalculator if there's one.
      uss.stopScrolling();

      window.requestAnimationFrame(() => {
        _bodyScrollbars[0].updatePosition();
        _bodyScrollbars[1].updatePosition();
      })
    }, null, true, true);
  }, {passive:true});
</script>
