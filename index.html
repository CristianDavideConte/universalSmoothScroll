<html>
  <head>
    <meta charset = "UTF-8">
    <meta name = "Description" content = "Universal smooth scroll demo">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <title>Universal Smooth Scroll</title>
    <link rel = "icon" type = "image/png" href = "./images/favicon.png">
    <link rel = "stylesheet" type = "text/css" href = "./css/universalsmoothscroll.css">
    <!--<script async src = "https://rawcdn.githack.com/CristianDavideConte/universalSmoothScroll/7b0ccdcd10abc65094d611695775ef5b9981d261/js/universalsmoothscroll-min.js"></script>-->
    <!--<script async src = "https://raw.githack.com/CristianDavideConte/universalSmoothScroll/master/js/universalsmoothscroll-min.js"></script>-->
    <script async src = "./js/universalsmoothscroll.js"></script>
  </head>
  <body onload = "init()" oncontextmenu = "return false">
    <section id = "stopScrollingButtonsSection">
      <button id = "stopScrollingX">STOP X</button>
      <button id = "stopScrollingY">STOP Y</button>
    </section>
    <nav id = "header">
      <ul>
        <li><a href = "#section1">YELLOW</a></li>
        <li><a href = "#section2">BLUE</a></li>
        <li><a href = "#section4">GREEN</a></li>
        <li><a href = "#section3">RED</a></li>
      </ul>
    </nav>

    <!--SECTION 1 AND 2 -->
    <div class = "sections-container">
      <div id = "section1" class = "page">
        <div id = "easeFunctionSelector">
          <h2>Change Ease Function</h2>
          <ul>
            <li><a id = "linear"        >linear</a></li>
            <li><a id = "easeInQuart"   >easeInQuart</a></li>
            <li><a id = "easeInQuint"   >easeInQuint</a></li>
            <li><a id = "easeOutCirc"   >easeOutCirc</a></li>
            <li><a id = "easeOutExpo"   >easeOutExpo</a></li>
            <li><a id = "easeInOutQuint">easeInOutQuint</a></li>
            <li><a id = "easeInOutCirc" >easeInOutCirc</a></li>
            <li><a id = "easeInOutExpo" >easeInOutExpo</a></li>
          </ul>
        </div>
      </div>
      <div id = "section2" class = "page">
        <section id = "yScroller">
          <button id = "yScrollerUp">&uarr;</button>
          <div class = "scrollerSections">
            <div id = "section12" class = "listItem"></div>
            <div id = "section22" class = "listItem"></div>
            <div id = "section32" class = "listItem"></div>
            <div id = "section42" class = "listItem"></div>
          </div>
          <button id = "yScrollerDown">&darr;</button>
        </section>
      </div>
    </div>

    <!--SECTION 3 AND 4 -->
    <div class = "sections-container">
      <div id = "section3" class = "page">
        <section id = "xScroller">
          <button id = "xScrollerLeft">&larr;</button>
          <div id = "xScrollerSection" class = "scrollerSections">
            <div id = "section11" class = "listItem"></div>
            <div id = "section21" class = "listItem"></div>
            <div id = "section31" class = "listItem"></div>
            <div id = "section41" class = "listItem"></div>
          </div>
          <button id = "xScrollerRight">&rarr;</button>
        </section>
      </div>
      <div id = "section4" class = "page"></div>
    </div>
  </body>
</html>
<script>
  function init() {
    const body = document.body;

    let yScroller = document.getElementsByClassName("scrollerSections")[0];
    let yScrollerUpButton = document.getElementById("yScrollerUp");
    let yScrollerDownButton = document.getElementById("yScrollerDown");

    let xScroller = document.getElementsByClassName("scrollerSections")[1];
    let xScrollerLeftButton = document.getElementById("xScrollerLeft");
    let xScrollerRightButton = document.getElementById("xScrollerRight");

    //Create a map to keep track of each scroll-animation's previous easeValue for every container
    let containersXAnimationsProgressesMap = new Map();
    let containersYAnimationsProgressesMap = new Map();
    let animationStepNumber = 25;
    let animationStepIncrease = 100 / animationStepNumber * 0.01;

    //Initially set all the containers previous <xProgress, xEaseValue> and <yProgress, yEaseValue> to 0
    containersXAnimationsProgressesMap.set(body, [0, 0]);
    containersYAnimationsProgressesMap.set(body, [0, 0]);

    function linear(x) {
      return x + 0.01;
    }

    function easeInQuart(x) {
      return x * x * x * x; //easeInQuart
    }

    function easeInQuint(x) {
      return x * x * x * x * x; //easeInQuint
    }

    function easeOutCirc(x) {
      return Math.sqrt(1 - Math.pow(x - 1, 2)); //easeOutCirc
    }

    function easeOutExpo(x) {
      return x === 1 ? 1 : 1 - Math.pow(2, -10 * x); //easeOutExpo
    }

    function easeInOutQuint(x) {
      return x < 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2; //easeInOutQuint
    }

    function easeInOutCirc(x) {
      return x < 0.5
             ? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2
             : (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2; //easeInOutCirc
    }

    function easeInOutExpo(x) {
      return x === 0
             ? 0
             : x === 1
             ? 1
             : x < 0.5 ? Math.pow(2, 20 * x - 10) / 2
             : (2 - Math.pow(2, -20 * x + 10)) / 2; //easeInOutExpo
    }

    let bezierCurve = easeInOutExpo;

    function easeFunction(remaning, time, total, currentPos, finalPos, container, axisNumber) {
      let previousAnimationProgresses;
      let previousAxisAnimationProgress, previousEaseValue;
      let currentAxisAnimationProgress, currentEaseValue;

      if(axisNumber === 0) {
        previousAnimationProgresses = containersXAnimationsProgressesMap.get(container);
      } else {
        previousAnimationProgresses = containersYAnimationsProgressesMap.get(container);
      }

      //Calculate the current scroll-animation's easeValue in range [0..1]
      previousAxisAnimationProgress = previousAnimationProgresses[0];
      previousEaseValue = previousAnimationProgresses[1];
      currentEaseValue = bezierCurve(previousAxisAnimationProgress + animationStepIncrease, total);

      //Calculate the scroll-animation's speed increase by using the current and the previous easeValue for the current container
      const deltaProgress = Math.abs(currentEaseValue - previousEaseValue); //How much we've progressed in the scroll-animation
      const stepLength = deltaProgress * total + 1; //Around deltaProgress% of the totalScrollAmount

      //Update the easeValues for the current container
      if(axisNumber === 0) {//The scroll animation is being performed on the x-axis
        containersXAnimationsProgressesMap.set(container, [previousAxisAnimationProgress + animationStepIncrease, currentEaseValue]);
      } else { //The scroll animation is being performed on the y-axis
        containersYAnimationsProgressesMap.set(container, [previousAxisAnimationProgress + animationStepIncrease, currentEaseValue]);
      }

      return stepLength;
    }

    function resetEaseValue(container, axisNumber) {
      if(!axisNumber) {//The scroll animation is being performed on the x-axis
        const previousEaseValues = containersXAnimationsProgressesMap.get(container);
        containersXAnimationsProgressesMap.set(container, [0, previousEaseValues[1]]);
      } else { //The scroll animation is being performed on the y-axis
        const previousEaseValues = containersYAnimationsProgressesMap.get(container);
        containersYAnimationsProgressesMap.set(container, [previousEaseValues[1], 0]);
      }
    }

    function resetEaseValues(container) {
      containersXAnimationsProgressesMap.set(container, [0, 0]);
      containersYAnimationsProgressesMap.set(container, [0, 0]);
    }

    function myHrefSetup (includeHidden = false) {
      const pageLinks = document.links;
      const pageURL = document.URL.split("#")[0];
      for(pageLink of pageLinks) {
        const pageLinkParts = pageLink.href.split("#"); //PageLink.href = OptionalURL#Section
        if(pageLinkParts[0] !== pageURL) continue;
        const elementToReach = document.getElementById(pageLinkParts[1]);
        if(elementToReach instanceof HTMLElement)
          pageLink.addEventListener("click", event => {
            event.preventDefault();
            resetEaseValues(body);
            uss.scrollIntoView(elementToReach, true, true, includeHidden);
          }, {passive:false});
      }
    }

    uss.setXStepLengthCalculator((remaning, time, total, currentPos, finalPos, container) => easeFunction(remaning, time, total, currentPos, finalPos, container, 0), body);
    uss.setYStepLengthCalculator((remaning, time, total, currentPos, finalPos, container) => easeFunction(remaning, time, total, currentPos, finalPos, container, 1), body);
    //uss.setYStepLengthCalculator(remaning => {return remaning / 15 + 1;}, body);
    //uss.setXStepLengthCalculator(remaning => {return remaning / 15 + 1;}, body);

    uss.setYStepLength(uss.getXStepLength());
    myHrefSetup();


    document.getElementById("linear").addEventListener("click", () => bezierCurve = linear);
    document.getElementById("easeInQuart").addEventListener("click", () => bezierCurve = easeInQuart);
    document.getElementById("easeInQuint").addEventListener("click", () => bezierCurve = easeInQuint);
    document.getElementById("easeOutCirc").addEventListener("click", () => bezierCurve = easeOutCirc);
    document.getElementById("easeOutExpo").addEventListener("click", () => bezierCurve = easeOutExpo);
    document.getElementById("easeInOutQuint").addEventListener("click", () => bezierCurve = easeInOutQuint);
    document.getElementById("easeInOutCirc").addEventListener("click", () => bezierCurve = easeInOutCirc);
    document.getElementById("easeInOutExpo").addEventListener("click", () => bezierCurve = easeInOutExpo);



    function scrollListX(direction) {
      let finalXPosition = (direction === -1) ? 0 : (xScroller.scrollWidth - xScroller.clientWidth);
      uss.scrollXTo(finalXPosition, xScroller, null, true);
    }
    xScrollerLeftButton.addEventListener("mousedown",  () => scrollListX(-1), {passive: false});
    xScrollerRightButton.addEventListener("mousedown", () => scrollListX(+1), {passive: false});
    xScrollerLeftButton.addEventListener("touchstart",  () => scrollListX(-1), {passive: false});
    xScrollerRightButton.addEventListener("touchstart", () => scrollListX(+1), {passive: false});

    xScrollerLeftButton.addEventListener("touchend",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("touchend", () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerLeftButton.addEventListener("mouseup",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("mouseup", () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerLeftButton.addEventListener("mouseout",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("mouseout", () => uss.stopScrollingX(xScroller), {passive:false});

    function scrollListY(direction) {
      let finalYPosition = (direction === -1) ? 0 : (yScroller.scrollHeight - yScroller.clientHeight);
      uss.scrollYTo(finalYPosition, yScroller, null, true);
    }
    yScrollerUpButton.addEventListener("mousedown",  () => scrollListY(-1), {passive: false});
    yScrollerDownButton.addEventListener("mousedown", () => scrollListY(+1), {passive: false});
    yScrollerUpButton.addEventListener("touchstart",  () => scrollListY(-1), {passive: false});
    yScrollerDownButton.addEventListener("touchstart", () => scrollListY(+1), {passive: false});

    yScrollerUpButton.addEventListener("touchend",  () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("touchend", () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerUpButton.addEventListener("mouseup",  () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("mouseup", () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerUpButton.addEventListener("mouseout",  () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("mouseout", () => uss.stopScrollingY(yScroller), {passive:false});

    body.addEventListener("wheel", () => {uss.stopScrollingY(body); uss.stopScrollingX(body, () => console.log("User Interacted: every scroll has been stopped"));}, {passive:false});
    document.getElementById("stopScrollingX").addEventListener("click", () => uss.stopScrollingX(body, () => console.log("scrollX stopped")), {passive:false});
    document.getElementById("stopScrollingY").addEventListener("click", () => uss.stopScrollingY(body, () => console.log("scrollY stopped")), {passive:false});
  }
</script>
