<html>
  <head>
    <meta charset = "UTF-8">
    <meta name = "Description" content = "Universal smooth scroll demo">
    <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
    <title>Universal Smooth Scroll</title>
    <link rel = "icon" type = "image/png" href = "./images/new_favicon.png">
    <link rel = "stylesheet" type = "text/css" href = "./css/universalsmoothscroll.css">
    <!--<script async src = "https://raw.githack.com/CristianDavideConte/universalSmoothScroll/master/old/universalsmoothscroll-old-min.js"></script>-->
    <!--<script async src = "https://rawcdn.githack.com/CristianDavideConte/universalSmoothScroll/41d6bbb80203a81e4dab942fe0328b9c237d823f/js/universalsmoothscroll-min.js"></script>-->
    <!--<script async src = "https://raw.githack.com/CristianDavideConte/universalSmoothScroll/master/js/universalsmoothscroll-min.js"></script>-->
    <script async src = "./js/universalsmoothscroll.js"></script>
    <script async src = "./js/universalsmoothscroll-ease-functions.js"></script>

  </head>
  <body onload = "init()">
    <section id = "stopScrollingButtonsSection">
      <button id = "stopScrollingX">STOP X</button>
      <button id = "stopScrollingY">STOP Y</button>
    </section>
    <nav id = "header">
      <ul>
        <li><a href = "#section1">YELLOW</a></li>
        <li><a href = "#section2">BLUE</a></li>
        <li><a href = "#section4">GREEN</a></li>
        <li><a href = "#section3">RED</a></li>
      </ul>
    </nav>

    <!--SECTION 1 AND 2 -->
    <div class = "sections-container">
      <div id = "section1" class = "page">
        <div id = "easeFunctionSelector">
          <h2>Change anchors' ease function</h2>
          <ul id = "easeFunctionSelectorList">
            <li><a id = "linear"        >linear</a></li>
            <li><a id = "easeInSine"    >easeInSine</a></li>
            <li><a id = "easeInQuad"    >easeInQuad</a></li>
            <li><a id = "easeInCubic"   >easeInCubic</a></li>
            <li><a id = "easeInQuart"   >easeInQuart</a></li>
            <li><a id = "easeInQuint"   >easeInQuint</a></li>
            <li><a id = "easeInExpo"    >easeInExpo</a></li>
            <li><a id = "easeInCirc"    >easeInCirc</a></li>
            <li><a id = "easeOutSine"   >easeOutSine</a></li>
            <li><a id = "easeOutQuad"   >easeOutQuad</a></li>
            <li><a id = "easeOutCubic"  >easeOutCubic</a></li>
            <li><a id = "easeOutQuart"  >easeOutQuart</a></li>
            <li><a id = "easeOutQuint"  >easeOutQuint</a></li>
            <li><a id = "easeOutExpo"   >easeOutExpo</a></li>
            <li><a id = "easeOutCirc"   >easeOutCirc</a></li>
            <li><a id = "easeInOutSine" >easeInOutSine</a></li>
            <li><a id = "easeInOutQuad" >easeInOutQuad</a></li>
            <li><a id = "easeInOutCubic">easeInOutCubic</a></li>
            <li><a id = "easeInOutQuart">easeInOutQuart</a></li>
            <li><a id = "easeInOutQuint">easeInOutQuint</a></li>
            <li><a id = "easeInOutExpo" >easeInOutExpo</a></li>
            <li><a id = "easeInOutCirc" >easeInOutCirc</a></li>

            <li><a id = "easeInBounce"  >easeInBounce</a></li>
            <li><a id = "easeOutBounce" >easeOutBounce</a></li>
            <li><a id = "easeInOutBounce" >easeInOutBounce</a></li>
          </ul>
        </div>
      </div>
      <div id = "section2" class = "page">
        <section id = "yScroller">
          <button id = "yScrollerUp">&uarr;</button>
          <div id = "yScrollerSection" class = "scrollerSections">
            <div id = "section12" class = "listItem"></div>
            <div id = "section22" class = "listItem"></div>
            <div id = "section32" class = "listItem"></div>
            <div id = "section42" class = "listItem"></div>
          </div>
          <button id = "yScrollerDown">&darr;</button>
        </section>
      </div>
    </div>

    <!--SECTION 3 AND 4 -->
    <div class = "sections-container">
      <div id = "section3" class = "page">
        <section id = "xScroller">
          <button id = "xScrollerLeft">&larr;</button>
          <div id = "xScrollerSection" class = "scrollerSections">
            <div id = "section11" class = "listItem"></div>
            <div id = "section21" class = "listItem"></div>
            <div id = "section31" class = "listItem"></div>
            <div id = "section41" class = "listItem"></div>
          </div>
          <button id = "xScrollerRight">&rarr;</button>
        </section>
      </div>
      <div id = "section4" class = "page">
        <div id = "customBezierParameterSection">
          <h2 id = "bezierTitle">Choose custom cubic-bezier parameters</h2>
          <ul>
            <li><input type = "text" class = "cubicBezierParameter" value = "0"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "0"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "1"/></li>
            <li><input type = "text" class = "cubicBezierParameter" value = "1"/></li>
          </ul>
          <input type = "submit" value = "Customize"></input>
        </div>
      </div>
    </div>
  </body>
</html>
<script>
  function init() {
    const pageScroller = document.body;
    const defaultEase = (remaning) => {return remaning / 20 + 1;};

    let yScroller = document.getElementsByClassName("scrollerSections")[0];
    let yScrollerUpButton = document.getElementById("yScrollerUp");
    let yScrollerDownButton = document.getElementById("yScrollerDown");

    let xScroller = document.getElementsByClassName("scrollerSections")[1];
    let xScrollerLeftButton = document.getElementById("xScrollerLeft");
    let xScrollerRightButton = document.getElementById("xScrollerRight");

    let cubicBezierCustomInputParameters = document.getElementsByTagName("input");
    let easeFunctionSelectorList = document.getElementById("easeFunctionSelectorList");

    let lastAnchorPressed = null;
    let storedCalculator = EASE_LINEAR();
    let wheelScrolled = false;

    uss.setPageScroller(pageScroller);
    uss.hrefSetup(null, null, (anchor, el) => {
      if(uss.getYStepLengthCalculator() === defaultEase) {
        uss.setStepLengthCalculator(storedCalculator);
      }

      storedCalculator = null;
      wheelScrolled = false;

      if(lastAnchorPressed === anchor && uss.isScrolling()) return false;
      lastAnchorPressed = anchor;
      uss.stopScrolling();
      return true;
    }, null, false);
    uss.setStepLengthCalculator(EASE_LINEAR());

    easeFunctionSelectorList.addEventListener("wheel", event => {
      event.preventDefault();
      event.stopPropagation();
      uss.scrollYBy(event.deltaY, easeFunctionSelectorList, null, false);
    }, {passive:false});
    easeFunctionSelectorList.addEventListener("touchmove", event => event.stopPropagation(), {passive:true});
    uss.setStepLengthCalculator(defaultEase, easeFunctionSelectorList);

    const listItems = easeFunctionSelectorList.children;
    listItems[0].classList.add("selected");
    for(let li of listItems) {
      const button = li.children[0];
      button.addEventListener("click", () => {
        for(let li of listItems) {
          li.classList.remove("selected");
        }
        li.classList.add("selected");
      }, {passive:true});
    }

    document.getElementById("linear").addEventListener("click",          () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_LINEAR())});

    document.getElementById("easeInSine").addEventListener("click",      () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_SINE())});
    document.getElementById("easeInQuad").addEventListener("click",      () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_QUAD())});
    document.getElementById("easeInCubic").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_CUBIC())});
    document.getElementById("easeInQuart").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_QUART())});
    document.getElementById("easeInQuint").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_QUINT())});
    document.getElementById("easeInExpo").addEventListener("click",      () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_EXPO())});
    document.getElementById("easeInCirc").addEventListener("click",      () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_CIRC())});

    document.getElementById("easeOutSine").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_SINE())});
    document.getElementById("easeOutQuad").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_QUAD())});
    document.getElementById("easeOutCubic").addEventListener("click",    () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_CUBIC())});
    document.getElementById("easeOutQuart").addEventListener("click",    () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_QUART())});
    document.getElementById("easeOutQuint").addEventListener("click",    () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_QUINT())});
    document.getElementById("easeOutExpo").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_EXPO())});
    document.getElementById("easeOutCirc").addEventListener("click",     () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_CIRC())});

    document.getElementById("easeInOutSine").addEventListener("click",   () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_SINE())});
    document.getElementById("easeInOutQuad").addEventListener("click",   () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_QUAD())});
    document.getElementById("easeInOutCubic").addEventListener("click",  () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_CUBIC())});
    document.getElementById("easeInOutQuart").addEventListener("click",  () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_QUART())});
    document.getElementById("easeInOutQuint").addEventListener("click",  () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_QUINT())});
    document.getElementById("easeInOutExpo").addEventListener("click",   () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_EXPO())});
    document.getElementById("easeInOutCirc").addEventListener("click",   () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_CIRC())});

    document.getElementById("easeInBounce").addEventListener("click",    () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_BOUNCE())});
    document.getElementById("easeOutBounce").addEventListener("click",   () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_OUT_BOUNCE())});
    document.getElementById("easeInOutBounce").addEventListener("click", () => {storedCalculator = null; uss.setStepLengthCalculator(EASE_IN_OUT_BOUNCE())});


    function scrollListX(direction) {
      uss.setXStepLengthCalculator(EASE_IN_OUT_QUAD(1000), xScroller);
      const finalXPosition = (direction === -1) ? 0 : uss.getMaxScrollX(xScroller);
      uss.scrollXTo(finalXPosition, xScroller, null, true);
    }

    uss.setXStepLengthCalculator(EASE_IN_OUT_QUAD(1000), xScroller);
    xScroller.addEventListener("wheel", event => {
      event.preventDefault();
      event.stopPropagation();
      uss.setXStepLengthCalculator(defaultEase, xScroller);
      uss.scrollXBy(event.deltaY, xScroller, null, false);
    }, {passive:false});
    xScroller.addEventListener("touchmove", event => event.stopPropagation(), {passive:true});

    xScrollerLeftButton.addEventListener("mousedown",   () => scrollListX(-1), {passive: false});
    xScrollerRightButton.addEventListener("mousedown",  () => scrollListX(+1), {passive: false});
    xScrollerLeftButton.addEventListener("touchstart",  () => scrollListX(-1), {passive: false});
    xScrollerRightButton.addEventListener("touchstart", () => scrollListX(+1), {passive: false});

    xScrollerLeftButton.addEventListener("touchend",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("touchend", () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerLeftButton.addEventListener("mouseup",   () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("mouseup",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerLeftButton.addEventListener("mouseout",  () => uss.stopScrollingX(xScroller), {passive:false});
    xScrollerRightButton.addEventListener("mouseout", () => uss.stopScrollingX(xScroller), {passive:false});

    function scrollListY(direction) {
      uss.setYStepLengthCalculator(EASE_OUT_EXPO(2000), yScroller);
      const finalYPosition = (direction === -1) ? 0 : uss.getMaxScrollY(yScroller);
      uss.scrollYTo(finalYPosition, yScroller, null, true);
    }

    uss.setYStepLengthCalculator(EASE_OUT_EXPO(2000), yScroller);
    yScroller.addEventListener("wheel", event => {
      event.preventDefault();
      event.stopPropagation();
      uss.setYStepLengthCalculator(defaultEase, yScroller);
      uss.scrollYBy(event.deltaY, yScroller, null, false);
    }, {passive:false});
    yScroller.addEventListener("touchmove", event => event.stopPropagation(), {passive:true});

    yScrollerUpButton.addEventListener("mousedown",    () => scrollListY(-1), {passive: false});
    yScrollerDownButton.addEventListener("mousedown",  () => scrollListY(+1), {passive: false});
    yScrollerUpButton.addEventListener("touchstart",   () => scrollListY(-1), {passive: false});
    yScrollerDownButton.addEventListener("touchstart", () => scrollListY(+1), {passive: false});

    yScrollerUpButton.addEventListener("touchend",   () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("touchend", () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerUpButton.addEventListener("mouseup",    () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("mouseup",  () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerUpButton.addEventListener("mouseout",   () => uss.stopScrollingY(yScroller), {passive:false});
    yScrollerDownButton.addEventListener("mouseout", () => uss.stopScrollingY(yScroller), {passive:false});

    let bezierTitleTimeout = 0;
    cubicBezierCustomInputParameters[4].addEventListener("click", () => {
      window.clearTimeout(bezierTitleTimeout);
      let u0, u1, u2, u3;
      const title = document.getElementById("bezierTitle");

      u0 = Number.parseFloat(cubicBezierCustomInputParameters[0].value);
      u1 = Number.parseFloat(cubicBezierCustomInputParameters[1].value);
      u2 = Number.parseFloat(cubicBezierCustomInputParameters[2].value);
      u3 = Number.parseFloat(cubicBezierCustomInputParameters[3].value);

      if(isNaN(u0) || isNaN(u1) || isNaN(u2) || isNaN(u3)) {
        title.innerHTML = "Parameters must be numbers from 0 to 1";
        bezierTitleTimeout = window.setTimeout(() => title.innerHTML = "Choose custom cubic-bezier parameters", 5000);
        return;
      }

      const _inputCheck = u0 > 1 || u0 < 0 || u1 > 1 || u1 < 0 || u2 > 1 || u2 < 0 || u3 > 1 || u3 < 0;
      if(_inputCheck) {
        title.innerHTML = "Parameters must be numbers from 0 to 1";
        bezierTitleTimeout = window.setTimeout(() => title.innerHTML = "Choose custom cubic-bezier parameters", 5000);
        return;
      }

      uss.setStepLengthCalculator(CUSTOM_CUBIC_BEZIER(u0, u1, u2, u3));
      title.innerHTML = "All set, try it out !";
      bezierTitleTimeout = window.setTimeout(() => title.innerHTML = "Choose custom cubic-bezier parameters", 5000);
    }, {passive:true});

    pageScroller.addEventListener("wheel", event => {
      event.preventDefault();
      event.stopPropagation();
      if(!wheelScrolled && uss.isScrolling()) uss.stopScrolling(pageScroller, () => console.log("Scrolling interrupted on both axises by the User"));
      if(storedCalculator === null) storedCalculator = uss.getYStepLengthCalculator();

      wheelScrolled = true;
      lastAnchorPressed = null;
      uss.setStepLengthCalculator(defaultEase);
      uss.scrollYBy(event.deltaY, pageScroller, null, false);
      return false;
    }, {passive:false});
    document.getElementById("stopScrollingX").addEventListener("click", () => {lastAnchorPressed = null; uss.stopScrollingX(pageScroller, () => console.log("scrollX stopped"));}, {passive:true});
    document.getElementById("stopScrollingY").addEventListener("click", () => {lastAnchorPressed = null; uss.stopScrollingY(pageScroller, () => console.log("scrollY stopped"));}, {passive:true});

    //Smooth scrolling for touch devices
    let _Y = null;
    let _X = null;
    pageScroller.addEventListener("touchstart", event => {
      if(_X == null) _X = event.touches[0].screenX;
      if(_Y == null) _Y = event.touches[0].screenY;
    },{passive:true});
    pageScroller.addEventListener("touchend", event => {
      _Y = null;
      _X = null;
    }, {passive:true});
    pageScroller.addEventListener("touchmove", event => {
      event.preventDefault();
      if(storedCalculator !== defaultEase) {
        storedCalculator = uss.getYStepLengthCalculator() !== defaultEase ? uss.getYStepLengthCalculator() : storedCalculator;
        uss.setStepLengthCalculator(defaultEase);
      }

      const _originalDeltaX = _X - event.changedTouches[0].screenX;
      const _originalDeltaY = _Y - event.changedTouches[0].screenY;
      const _deltaX = Math.abs(_originalDeltaX) > 1 ? 10 * _originalDeltaX : 0;
      const _deltaY = Math.abs(_originalDeltaY) > 1 ? 16 * _originalDeltaY : 0;
      uss.scrollBy(_deltaX, _deltaY);
      _X -= _originalDeltaX;
      _Y -= _originalDeltaY;
    }, {passive:false});
  }
</script>
